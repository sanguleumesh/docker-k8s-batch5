
# Find the host's main interface
ip a

# Create the IPvlan L2 network
docker network rm my_ipvlan_l2
docker network create -d ipvlan \
  --subnet=10.0.0.0/24 \
  --gateway=10.0.0.1 \
  -o parent=eth0 \
  my_ipvlan_l2

# Run IPvlan L2 containers
docker run -dit --network my_ipvlan_l2 --ip 10.0.0.100 --name ipvlan_l2_container1 busybox sh
docker run -dit --network my_ipvlan_l2 --ip 10.0.0.101 --name ipvlan_l2_container2 busybox sh

# Test container-to-container communication
docker exec -it ipvlan_l2_container1 ping -c 4 10.0.0.101

# Test host-to-container communication
ping -c 4 10.0.0.100

# Enable NAT for external internet access
sudo iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE

# Test container internet access
docker exec -it ipvlan_l2_container1 ping -c 4 8.8.8.8

# Test internal web server
docker exec -it ipvlan_l2_container1 sh -c "nc -l -p 8080"
docker exec -it ipvlan_l2_container2 curl http://10.0.0.100:8080

