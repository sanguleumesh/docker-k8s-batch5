
# Create a dummy network interface
sudo ip link add dummy0 type dummy
sudo ip addr add 192.168.100.1/24 dev dummy0
sudo ip link set dummy0 up

# Create a Macvlan network on the dummy interface
docker network create -d macvlan \
  --subnet=192.168.100.0/24 \
  --gateway=192.168.100.1 \
  -o parent=dummy0 \
  my_macvlan

# Run Macvlan containers
docker run -dit --network my_macvlan --ip 192.168.100.100 --name macvlan_container1 busybox sh
docker run -dit --network my_macvlan --ip 192.168.100.101 --name macvlan_container2 busybox sh

# Test container-to-container communication
docker exec -it macvlan_container1 ping -c 4 192.168.100.101

# Enable host-to-container communication
sudo ip link add macvlan_host link dummy0 type macvlan mode bridge
sudo ip addr add 192.168.100.200/24 dev macvlan_host
sudo ip link set macvlan_host up
ping -c 4 192.168.100.100
